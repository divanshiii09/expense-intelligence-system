{"ast":null,"code":"'use strict';\n\nconst applyTimestampsToChildren = require('../update/applyTimestampsToChildren');\nconst applyTimestampsToUpdate = require('../update/applyTimestampsToUpdate');\nconst handleTimestampOption = require('../schema/handleTimestampOption');\nconst setDocumentTimestamps = require('./setDocumentTimestamps');\nconst symbols = require('../../schema/symbols');\nconst replaceOps = new Set(['replaceOne', 'findOneAndReplace']);\nmodule.exports = function setupTimestamps(schema, timestamps) {\n  const childHasTimestamp = schema.childSchemas.find(withTimestamp);\n  function withTimestamp(s) {\n    const ts = s.schema.options.timestamps;\n    return !!ts;\n  }\n  if (!timestamps && !childHasTimestamp) {\n    return;\n  }\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n  const currentTime = timestamps != null && Object.hasOwn(timestamps, 'currentTime') ? timestamps.currentTime : null;\n  const schemaAdditions = {};\n  schema.$timestamps = {\n    createdAt: createdAt,\n    updatedAt: updatedAt\n  };\n  if (createdAt && !schema.paths[createdAt]) {\n    const baseImmutableCreatedAt = schema.base?.get('timestamps.createdAt.immutable') ?? null;\n    const immutable = baseImmutableCreatedAt ?? true;\n    schemaAdditions[createdAt] = {\n      [schema.options.typeKey || 'type']: Date,\n      immutable\n    };\n  }\n  if (updatedAt && !schema.paths[updatedAt]) {\n    schemaAdditions[updatedAt] = Date;\n  }\n  schema.add(schemaAdditions);\n  schema.pre('save', timestampsPreSave);\n  schema.methods.initializeTimestamps = function (timestampsOptions) {\n    if (timestampsOptions === false) {\n      return this;\n    }\n    const ts = currentTime != null ? currentTime() : this.constructor.base.now();\n    const initTimestampsCreatedAt = timestampsOptions != null ? handleTimestampOption(timestampsOptions, 'createdAt') : createdAt;\n    const initTimestampsUpdatedAt = timestampsOptions != null ? handleTimestampOption(timestampsOptions, 'updatedAt') : updatedAt;\n    if (initTimestampsCreatedAt && !this.get(initTimestampsCreatedAt)) {\n      this.$set(createdAt, ts);\n    }\n    if (initTimestampsUpdatedAt && !this.get(initTimestampsUpdatedAt)) {\n      this.$set(updatedAt, ts);\n    }\n    if (this.$isSubdocument) {\n      return this;\n    }\n    const subdocs = this.$getAllSubdocs();\n    for (const subdoc of subdocs) {\n      if (subdoc.initializeTimestamps) {\n        subdoc.initializeTimestamps(timestampsOptions);\n      }\n    }\n    return this;\n  };\n  const opts = {\n    query: true,\n    model: false\n  };\n  schema.pre('findOneAndReplace', opts, _setTimestampsOnUpdate);\n  schema.pre('findOneAndUpdate', opts, _setTimestampsOnUpdate);\n  schema.pre('replaceOne', opts, _setTimestampsOnUpdate);\n  schema.pre('update', opts, _setTimestampsOnUpdate);\n  schema.pre('updateOne', opts, _setTimestampsOnUpdate);\n  schema.pre('updateMany', opts, _setTimestampsOnUpdate);\n};\nfunction timestampsPreSave() {\n  const timestampOption = this.$__?.saveOptions?.timestamps;\n  if (timestampOption === false) {\n    return;\n  }\n  const schema = this.$__schema;\n  const {\n    createdAt,\n    updatedAt\n  } = schema.$timestamps;\n  const timestamps = schema.options.timestamps;\n  const currentTime = timestamps != null && Object.hasOwn(timestamps, 'currentTime') ? timestamps.currentTime : null;\n  setDocumentTimestamps(this, timestampOption, currentTime, createdAt, updatedAt);\n}\nfunction _setTimestampsOnUpdate() {\n  const schema = this.model.schema;\n  const {\n    createdAt,\n    updatedAt\n  } = schema.$timestamps;\n  const timestamps = schema.options.timestamps;\n  const currentTime = timestamps != null && Object.hasOwn(timestamps, 'currentTime') ? timestamps.currentTime : null;\n  const now = currentTime != null ? currentTime() : this.model.base.now();\n  // Replacing with null update should still trigger timestamps\n  if (replaceOps.has(this.op) && this.getUpdate() == null) {\n    this.setUpdate({});\n  }\n  applyTimestampsToUpdate(now, createdAt, updatedAt, this.getUpdate(), this._mongooseOptions, replaceOps.has(this.op));\n  applyTimestampsToChildren(now, this.getUpdate(), this.model.schema);\n}\ntimestampsPreSave[symbols.builtInMiddleware] = true;\n_setTimestampsOnUpdate[symbols.builtInMiddleware] = true;","map":{"version":3,"names":["applyTimestampsToChildren","require","applyTimestampsToUpdate","handleTimestampOption","setDocumentTimestamps","symbols","replaceOps","Set","module","exports","setupTimestamps","schema","timestamps","childHasTimestamp","childSchemas","find","withTimestamp","s","ts","options","createdAt","updatedAt","currentTime","Object","hasOwn","schemaAdditions","$timestamps","paths","baseImmutableCreatedAt","base","get","immutable","typeKey","Date","add","pre","timestampsPreSave","methods","initializeTimestamps","timestampsOptions","constructor","now","initTimestampsCreatedAt","initTimestampsUpdatedAt","$set","$isSubdocument","subdocs","$getAllSubdocs","subdoc","opts","query","model","_setTimestampsOnUpdate","timestampOption","$__","saveOptions","$__schema","has","op","getUpdate","setUpdate","_mongooseOptions","builtInMiddleware"],"sources":["C:/Users/bhavn/OneDrive/Desktop/FINSIGHT/node_modules/mongoose/lib/helpers/timestamps/setupTimestamps.js"],"sourcesContent":["'use strict';\n\nconst applyTimestampsToChildren = require('../update/applyTimestampsToChildren');\nconst applyTimestampsToUpdate = require('../update/applyTimestampsToUpdate');\nconst handleTimestampOption = require('../schema/handleTimestampOption');\nconst setDocumentTimestamps = require('./setDocumentTimestamps');\nconst symbols = require('../../schema/symbols');\n\nconst replaceOps = new Set([\n  'replaceOne',\n  'findOneAndReplace'\n]);\n\nmodule.exports = function setupTimestamps(schema, timestamps) {\n  const childHasTimestamp = schema.childSchemas.find(withTimestamp);\n  function withTimestamp(s) {\n    const ts = s.schema.options.timestamps;\n    return !!ts;\n  }\n  if (!timestamps && !childHasTimestamp) {\n    return;\n  }\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n  const currentTime = timestamps != null && Object.hasOwn(timestamps, 'currentTime') ?\n    timestamps.currentTime :\n    null;\n  const schemaAdditions = {};\n\n  schema.$timestamps = { createdAt: createdAt, updatedAt: updatedAt };\n\n  if (createdAt && !schema.paths[createdAt]) {\n    const baseImmutableCreatedAt = schema.base?.get('timestamps.createdAt.immutable') ?? null;\n    const immutable = baseImmutableCreatedAt ?? true;\n    schemaAdditions[createdAt] = { [schema.options.typeKey || 'type']: Date, immutable };\n  }\n\n  if (updatedAt && !schema.paths[updatedAt]) {\n    schemaAdditions[updatedAt] = Date;\n  }\n\n  schema.add(schemaAdditions);\n\n  schema.pre('save', timestampsPreSave);\n\n  schema.methods.initializeTimestamps = function(timestampsOptions) {\n    if (timestampsOptions === false) {\n      return this;\n    }\n    const ts = currentTime != null ?\n      currentTime() : this.constructor.base.now();\n\n    const initTimestampsCreatedAt = timestampsOptions != null ?\n      handleTimestampOption(timestampsOptions, 'createdAt') :\n      createdAt;\n    const initTimestampsUpdatedAt = timestampsOptions != null ?\n      handleTimestampOption(timestampsOptions, 'updatedAt') :\n      updatedAt;\n\n    if (initTimestampsCreatedAt && !this.get(initTimestampsCreatedAt)) {\n      this.$set(createdAt, ts);\n    }\n    if (initTimestampsUpdatedAt && !this.get(initTimestampsUpdatedAt)) {\n      this.$set(updatedAt, ts);\n    }\n    if (this.$isSubdocument) {\n      return this;\n    }\n\n    const subdocs = this.$getAllSubdocs();\n    for (const subdoc of subdocs) {\n      if (subdoc.initializeTimestamps) {\n        subdoc.initializeTimestamps(timestampsOptions);\n      }\n    }\n\n    return this;\n  };\n\n  const opts = { query: true, model: false };\n  schema.pre('findOneAndReplace', opts, _setTimestampsOnUpdate);\n  schema.pre('findOneAndUpdate', opts, _setTimestampsOnUpdate);\n  schema.pre('replaceOne', opts, _setTimestampsOnUpdate);\n  schema.pre('update', opts, _setTimestampsOnUpdate);\n  schema.pre('updateOne', opts, _setTimestampsOnUpdate);\n  schema.pre('updateMany', opts, _setTimestampsOnUpdate);\n};\n\nfunction timestampsPreSave() {\n  const timestampOption = this.$__?.saveOptions?.timestamps;\n  if (timestampOption === false) {\n    return;\n  }\n\n  const schema = this.$__schema;\n  const { createdAt, updatedAt } = schema.$timestamps;\n  const timestamps = schema.options.timestamps;\n  const currentTime = timestamps != null && Object.hasOwn(timestamps, 'currentTime') ?\n    timestamps.currentTime :\n    null;\n\n  setDocumentTimestamps(this, timestampOption, currentTime, createdAt, updatedAt);\n}\n\nfunction _setTimestampsOnUpdate() {\n  const schema = this.model.schema;\n  const { createdAt, updatedAt } = schema.$timestamps;\n  const timestamps = schema.options.timestamps;\n  const currentTime = timestamps != null && Object.hasOwn(timestamps, 'currentTime') ?\n    timestamps.currentTime :\n    null;\n\n  const now = currentTime != null ?\n    currentTime() :\n    this.model.base.now();\n  // Replacing with null update should still trigger timestamps\n  if (replaceOps.has(this.op) && this.getUpdate() == null) {\n    this.setUpdate({});\n  }\n  applyTimestampsToUpdate(\n    now,\n    createdAt,\n    updatedAt,\n    this.getUpdate(),\n    this._mongooseOptions,\n    replaceOps.has(this.op)\n  );\n  applyTimestampsToChildren(now, this.getUpdate(), this.model.schema);\n}\n\ntimestampsPreSave[symbols.builtInMiddleware] = true;\n_setTimestampsOnUpdate[symbols.builtInMiddleware] = true;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"'use strict';\n\nconst objectIdSymbol = require('../helpers/symbols').objectIdSymbol;\nconst symbols = require('../schema/symbols');\nconst utils = require('../utils');\n\n/*!\n * ignore\n */\n\nmodule.exports = function shardingPlugin(schema) {\n  schema.post('init', shardingPluginPostInit);\n  schema.pre('save', shardingPluginPreSave);\n  schema.post('save', shardingPluginPostSave);\n  schema.pre('deleteOne', {\n    document: true,\n    query: false\n  }, shardingPluginPreDeleteOne);\n  schema.pre('updateOne', {\n    document: true,\n    query: false\n  }, shardingPluginPreUpdateOne);\n};\nfunction shardingPluginPostInit() {\n  storeShard.call(this);\n  return this;\n}\nfunction shardingPluginPreSave() {\n  applyWhere.call(this);\n}\nfunction shardingPluginPostSave() {\n  storeShard.call(this);\n}\nfunction shardingPluginPreDeleteOne() {\n  applyWhere.call(this);\n}\nfunction shardingPluginPreUpdateOne() {\n  applyWhere.call(this);\n}\n\n/*!\n * ignore\n */\n\nfunction applyWhere() {\n  let paths;\n  let len;\n  if (this.$__.shardval) {\n    paths = Object.keys(this.$__.shardval);\n    len = paths.length;\n    this.$where = this.$where || {};\n    for (let i = 0; i < len; ++i) {\n      this.$where[paths[i]] = this.$__.shardval[paths[i]];\n    }\n  }\n}\n\n/*!\n * ignore\n */\n\nmodule.exports.storeShard = storeShard;\n\n/*!\n * ignore\n */\n\nfunction storeShard() {\n  // backwards compat\n  const key = this.$__schema.options.shardKey || this.$__schema.options.shardkey;\n  if (!utils.isPOJO(key)) {\n    return;\n  }\n  const orig = this.$__.shardval = {};\n  const paths = Object.keys(key);\n  const len = paths.length;\n  let val;\n  for (let i = 0; i < len; ++i) {\n    val = this.$__getValue(paths[i]);\n    if (val == null) {\n      orig[paths[i]] = val;\n    } else if (utils.isMongooseObject(val)) {\n      orig[paths[i]] = val.toObject({\n        depopulate: true,\n        _isNested: true\n      });\n    } else if (val instanceof Date || val[objectIdSymbol]) {\n      orig[paths[i]] = val;\n    } else if (typeof val.valueOf === 'function') {\n      orig[paths[i]] = val.valueOf();\n    } else {\n      orig[paths[i]] = val;\n    }\n  }\n}\nshardingPluginPostInit[symbols.builtInMiddleware] = true;\nshardingPluginPreSave[symbols.builtInMiddleware] = true;\nshardingPluginPostSave[symbols.builtInMiddleware] = true;\nshardingPluginPreDeleteOne[symbols.builtInMiddleware] = true;\nshardingPluginPreUpdateOne[symbols.builtInMiddleware] = true;","map":{"version":3,"names":["objectIdSymbol","require","symbols","utils","module","exports","shardingPlugin","schema","post","shardingPluginPostInit","pre","shardingPluginPreSave","shardingPluginPostSave","document","query","shardingPluginPreDeleteOne","shardingPluginPreUpdateOne","storeShard","call","applyWhere","paths","len","$__","shardval","Object","keys","length","$where","i","key","$__schema","options","shardKey","shardkey","isPOJO","orig","val","$__getValue","isMongooseObject","toObject","depopulate","_isNested","Date","valueOf","builtInMiddleware"],"sources":["C:/Users/bhavn/OneDrive/Desktop/FINSIGHT/node_modules/mongoose/lib/plugins/sharding.js"],"sourcesContent":["'use strict';\n\nconst objectIdSymbol = require('../helpers/symbols').objectIdSymbol;\nconst symbols = require('../schema/symbols');\nconst utils = require('../utils');\n\n/*!\n * ignore\n */\n\nmodule.exports = function shardingPlugin(schema) {\n  schema.post('init', shardingPluginPostInit);\n  schema.pre('save', shardingPluginPreSave);\n  schema.post('save', shardingPluginPostSave);\n  schema.pre('deleteOne', { document: true, query: false }, shardingPluginPreDeleteOne);\n  schema.pre('updateOne', { document: true, query: false }, shardingPluginPreUpdateOne);\n};\n\nfunction shardingPluginPostInit() {\n  storeShard.call(this);\n  return this;\n}\n\nfunction shardingPluginPreSave() {\n  applyWhere.call(this);\n}\n\nfunction shardingPluginPostSave() {\n  storeShard.call(this);\n}\n\nfunction shardingPluginPreDeleteOne() {\n  applyWhere.call(this);\n}\n\nfunction shardingPluginPreUpdateOne() {\n  applyWhere.call(this);\n}\n\n/*!\n * ignore\n */\n\nfunction applyWhere() {\n  let paths;\n  let len;\n\n  if (this.$__.shardval) {\n    paths = Object.keys(this.$__.shardval);\n    len = paths.length;\n\n    this.$where = this.$where || {};\n    for (let i = 0; i < len; ++i) {\n      this.$where[paths[i]] = this.$__.shardval[paths[i]];\n    }\n  }\n}\n\n/*!\n * ignore\n */\n\nmodule.exports.storeShard = storeShard;\n\n/*!\n * ignore\n */\n\nfunction storeShard() {\n  // backwards compat\n  const key = this.$__schema.options.shardKey || this.$__schema.options.shardkey;\n  if (!utils.isPOJO(key)) {\n    return;\n  }\n\n  const orig = this.$__.shardval = {};\n  const paths = Object.keys(key);\n  const len = paths.length;\n  let val;\n\n  for (let i = 0; i < len; ++i) {\n    val = this.$__getValue(paths[i]);\n    if (val == null) {\n      orig[paths[i]] = val;\n    } else if (utils.isMongooseObject(val)) {\n      orig[paths[i]] = val.toObject({ depopulate: true, _isNested: true });\n    } else if (val instanceof Date || val[objectIdSymbol]) {\n      orig[paths[i]] = val;\n    } else if (typeof val.valueOf === 'function') {\n      orig[paths[i]] = val.valueOf();\n    } else {\n      orig[paths[i]] = val;\n    }\n  }\n}\n\nshardingPluginPostInit[symbols.builtInMiddleware] = true;\nshardingPluginPreSave[symbols.builtInMiddleware] = true;\nshardingPluginPostSave[symbols.builtInMiddleware] = true;\nshardingPluginPreDeleteOne[symbols.builtInMiddleware] = true;\nshardingPluginPreUpdateOne[symbols.builtInMiddleware] = true;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}
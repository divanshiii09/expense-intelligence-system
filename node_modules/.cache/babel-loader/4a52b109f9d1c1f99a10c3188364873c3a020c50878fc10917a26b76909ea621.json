{"ast":null,"code":"'use strict';\n\n/*!\n * ignore\n */\nconst MongooseMap = require('../types/map');\nconst SchemaMapOptions = require('../options/schemaMapOptions');\nconst SchemaType = require('../schemaType');\nconst createJSONSchemaTypeDefinition = require('../helpers/createJSONSchemaTypeDefinition');\nconst MongooseError = require('../error/mongooseError');\nconst Schema = require('../schema');\nconst utils = require('../utils');\nclass SchemaMap extends SchemaType {\n  /**\n   * Map SchemaType constructor.\n   *\n   * @param {String} path\n   * @param {Object} options\n   * @param {Object} schemaOptions\n   * @param {Schema} parentSchema\n   * @inherits SchemaType\n   * @api public\n   */\n\n  constructor(key, options, schemaOptions, parentSchema) {\n    super(key, options, 'Map', parentSchema);\n    this.$isSchemaMap = true;\n    // Create the nested schema type for the map values\n    this._createNestedSchemaType(parentSchema, key, options, schemaOptions);\n  }\n\n  /**\n   * Sets a default option for all Map instances.\n   *\n   * @param {String} option The option you'd like to set the value for\n   * @param {Any} value value for option\n   * @return {undefined}\n   * @function set\n   * @api public\n   */\n\n  set(option, value) {\n    return SchemaType.set(option, value);\n  }\n\n  /**\n   * Casts to Map\n   *\n   * @param {Object} value\n   * @param {Object} model this value is optional\n   * @api private\n   */\n\n  cast(val, doc, init, prev, options) {\n    if (val instanceof MongooseMap) {\n      return val;\n    }\n    const path = options?.path ?? this.path;\n    if (init) {\n      const map = new MongooseMap({}, path, doc, this.$__schemaType);\n      if (val instanceof global.Map) {\n        for (const key of val.keys()) {\n          let _val = val.get(key);\n          if (_val == null) {\n            _val = map.$__schemaType._castNullish(_val);\n          } else {\n            _val = map.$__schemaType.cast(_val, doc, true, null, {\n              ...options,\n              path: path + '.' + key\n            });\n          }\n          map.$init(key, _val);\n        }\n      } else {\n        for (const key of Object.keys(val)) {\n          let _val = val[key];\n          if (_val == null) {\n            _val = map.$__schemaType._castNullish(_val);\n          } else {\n            _val = map.$__schemaType.cast(_val, doc, true, null, {\n              ...options,\n              path: path + '.' + key\n            });\n          }\n          map.$init(key, _val);\n        }\n      }\n      return map;\n    }\n    return new MongooseMap(val, path, doc, this.$__schemaType);\n  }\n\n  /**\n   * Creates a copy of this map schema type.\n   *\n   * @api private\n   */\n\n  clone() {\n    const schematype = super.clone();\n    if (this.$__schemaType != null) {\n      schematype.$__schemaType = this.$__schemaType.clone();\n    }\n    return schematype;\n  }\n\n  /**\n   * Returns the embedded schema type (i.e. the `.$*` path)\n   *\n   * @api public\n   */\n\n  getEmbeddedSchemaType() {\n    return this.$__schemaType;\n  }\n\n  /**\n   * Returns this schema type's representation in a JSON schema.\n   *\n   * @param [options]\n   * @param [options.useBsonType=false] If true, return a representation with `bsonType` for use with MongoDB's `$jsonSchema`.\n   * @returns {Object} JSON schema properties\n   */\n\n  toJSONSchema(options) {\n    const useBsonType = options?.useBsonType;\n    const embeddedSchemaType = this.getEmbeddedSchemaType();\n    const isRequired = this.options.required && typeof this.options.required !== 'function';\n    const result = createJSONSchemaTypeDefinition('object', 'object', useBsonType, isRequired);\n    result.additionalProperties = embeddedSchemaType.toJSONSchema(options);\n    return result;\n  }\n\n  /**\n   * Returns the auto encryption type for this schema type.\n   *\n   * @api public\n   */\n\n  autoEncryptionType() {\n    return 'object';\n  }\n}\n\n/**\n * This schema type's name, to defend against minifiers that mangle\n * function names.\n *\n * @api public\n */\n\nSchemaMap.schemaName = 'Map';\nSchemaMap.prototype.OptionsConstructor = SchemaMapOptions;\nSchemaMap.defaultOptions = {};\n\n/*!\n * ignore\n */\n\nSchemaMap.prototype._createNestedSchemaType = function _createNestedSchemaType(schema, path, obj, options) {\n  const mapPath = path + '.$*';\n  let _mapType = {\n    type: {}\n  };\n  if (utils.hasUserDefinedProperty(obj, 'of')) {\n    const isInlineSchema = utils.isPOJO(obj.of) && utils.hasOwnKeys(obj.of) && !utils.hasUserDefinedProperty(obj.of, schema.options.typeKey);\n    if (isInlineSchema) {\n      _mapType = {\n        [schema.options.typeKey]: new Schema(obj.of)\n      };\n    } else if (utils.isPOJO(obj.of)) {\n      _mapType = Object.assign({}, obj.of);\n    } else {\n      _mapType = {\n        [schema.options.typeKey]: obj.of\n      };\n    }\n    if (_mapType[schema.options.typeKey] && _mapType[schema.options.typeKey].instanceOfSchema) {\n      const subdocumentSchema = _mapType[schema.options.typeKey];\n      subdocumentSchema.eachPath((subpath, type) => {\n        if (type.options.select === true || type.options.select === false) {\n          throw new MongooseError('Cannot use schema-level projections (`select: true` or `select: false`) within maps at path \"' + path + '.' + subpath + '\"');\n        }\n      });\n    }\n    if (utils.hasUserDefinedProperty(obj, 'ref')) {\n      _mapType.ref = obj.ref;\n    }\n  }\n  this.$__schemaType = schema.interpretAsType(mapPath, _mapType, options);\n};\nmodule.exports = SchemaMap;","map":{"version":3,"names":["MongooseMap","require","SchemaMapOptions","SchemaType","createJSONSchemaTypeDefinition","MongooseError","Schema","utils","SchemaMap","constructor","key","options","schemaOptions","parentSchema","$isSchemaMap","_createNestedSchemaType","set","option","value","cast","val","doc","init","prev","path","map","$__schemaType","global","Map","keys","_val","get","_castNullish","$init","Object","clone","schematype","getEmbeddedSchemaType","toJSONSchema","useBsonType","embeddedSchemaType","isRequired","required","result","additionalProperties","autoEncryptionType","schemaName","prototype","OptionsConstructor","defaultOptions","schema","obj","mapPath","_mapType","type","hasUserDefinedProperty","isInlineSchema","isPOJO","of","hasOwnKeys","typeKey","assign","instanceOfSchema","subdocumentSchema","eachPath","subpath","select","ref","interpretAsType","module","exports"],"sources":["C:/Users/bhavn/OneDrive/Desktop/FINSIGHT/node_modules/mongoose/lib/schema/map.js"],"sourcesContent":["'use strict';\n\n/*!\n * ignore\n */\n\nconst MongooseMap = require('../types/map');\nconst SchemaMapOptions = require('../options/schemaMapOptions');\nconst SchemaType = require('../schemaType');\nconst createJSONSchemaTypeDefinition = require('../helpers/createJSONSchemaTypeDefinition');\nconst MongooseError = require('../error/mongooseError');\nconst Schema = require('../schema');\nconst utils = require('../utils');\n\nclass SchemaMap extends SchemaType {\n  /**\n   * Map SchemaType constructor.\n   *\n   * @param {String} path\n   * @param {Object} options\n   * @param {Object} schemaOptions\n   * @param {Schema} parentSchema\n   * @inherits SchemaType\n   * @api public\n   */\n\n  constructor(key, options, schemaOptions, parentSchema) {\n    super(key, options, 'Map', parentSchema);\n    this.$isSchemaMap = true;\n    // Create the nested schema type for the map values\n    this._createNestedSchemaType(parentSchema, key, options, schemaOptions);\n  }\n\n  /**\n   * Sets a default option for all Map instances.\n   *\n   * @param {String} option The option you'd like to set the value for\n   * @param {Any} value value for option\n   * @return {undefined}\n   * @function set\n   * @api public\n   */\n\n  set(option, value) {\n    return SchemaType.set(option, value);\n  }\n\n  /**\n   * Casts to Map\n   *\n   * @param {Object} value\n   * @param {Object} model this value is optional\n   * @api private\n   */\n\n  cast(val, doc, init, prev, options) {\n    if (val instanceof MongooseMap) {\n      return val;\n    }\n\n    const path = options?.path ?? this.path;\n\n    if (init) {\n      const map = new MongooseMap({}, path, doc, this.$__schemaType);\n\n      if (val instanceof global.Map) {\n        for (const key of val.keys()) {\n          let _val = val.get(key);\n          if (_val == null) {\n            _val = map.$__schemaType._castNullish(_val);\n          } else {\n            _val = map.$__schemaType.cast(_val, doc, true, null, { ...options, path: path + '.' + key });\n          }\n          map.$init(key, _val);\n        }\n      } else {\n        for (const key of Object.keys(val)) {\n          let _val = val[key];\n          if (_val == null) {\n            _val = map.$__schemaType._castNullish(_val);\n          } else {\n            _val = map.$__schemaType.cast(_val, doc, true, null, { ...options, path: path + '.' + key });\n          }\n          map.$init(key, _val);\n        }\n      }\n\n      return map;\n    }\n\n    return new MongooseMap(val, path, doc, this.$__schemaType);\n  }\n\n  /**\n   * Creates a copy of this map schema type.\n   *\n   * @api private\n   */\n\n  clone() {\n    const schematype = super.clone();\n\n    if (this.$__schemaType != null) {\n      schematype.$__schemaType = this.$__schemaType.clone();\n    }\n    return schematype;\n  }\n\n  /**\n   * Returns the embedded schema type (i.e. the `.$*` path)\n   *\n   * @api public\n   */\n\n  getEmbeddedSchemaType() {\n    return this.$__schemaType;\n  }\n\n  /**\n   * Returns this schema type's representation in a JSON schema.\n   *\n   * @param [options]\n   * @param [options.useBsonType=false] If true, return a representation with `bsonType` for use with MongoDB's `$jsonSchema`.\n   * @returns {Object} JSON schema properties\n   */\n\n  toJSONSchema(options) {\n    const useBsonType = options?.useBsonType;\n    const embeddedSchemaType = this.getEmbeddedSchemaType();\n\n    const isRequired = this.options.required && typeof this.options.required !== 'function';\n    const result = createJSONSchemaTypeDefinition('object', 'object', useBsonType, isRequired);\n    result.additionalProperties = embeddedSchemaType.toJSONSchema(options);\n\n    return result;\n  }\n\n  /**\n   * Returns the auto encryption type for this schema type.\n   *\n   * @api public\n   */\n\n  autoEncryptionType() {\n    return 'object';\n  }\n}\n\n/**\n * This schema type's name, to defend against minifiers that mangle\n * function names.\n *\n * @api public\n */\n\nSchemaMap.schemaName = 'Map';\n\nSchemaMap.prototype.OptionsConstructor = SchemaMapOptions;\n\nSchemaMap.defaultOptions = {};\n\n/*!\n * ignore\n */\n\nSchemaMap.prototype._createNestedSchemaType = function _createNestedSchemaType(schema, path, obj, options) {\n  const mapPath = path + '.$*';\n  let _mapType = { type: {} };\n  if (utils.hasUserDefinedProperty(obj, 'of')) {\n    const isInlineSchema = utils.isPOJO(obj.of) &&\n      utils.hasOwnKeys(obj.of) &&\n      !utils.hasUserDefinedProperty(obj.of, schema.options.typeKey);\n    if (isInlineSchema) {\n      _mapType = { [schema.options.typeKey]: new Schema(obj.of) };\n    } else if (utils.isPOJO(obj.of)) {\n      _mapType = Object.assign({}, obj.of);\n    } else {\n      _mapType = { [schema.options.typeKey]: obj.of };\n    }\n\n    if (_mapType[schema.options.typeKey] && _mapType[schema.options.typeKey].instanceOfSchema) {\n      const subdocumentSchema = _mapType[schema.options.typeKey];\n      subdocumentSchema.eachPath((subpath, type) => {\n        if (type.options.select === true || type.options.select === false) {\n          throw new MongooseError('Cannot use schema-level projections (`select: true` or `select: false`) within maps at path \"' + path + '.' + subpath + '\"');\n        }\n      });\n    }\n\n    if (utils.hasUserDefinedProperty(obj, 'ref')) {\n      _mapType.ref = obj.ref;\n    }\n  }\n  this.$__schemaType = schema.interpretAsType(mapPath, _mapType, options);\n};\n\nmodule.exports = SchemaMap;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}